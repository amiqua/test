<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <title>Pong Game</title>
  <style>
    body { margin: 0; background: black; display: flex; justify-content: center; align-items: center; height: 100vh; }
    canvas { background: #111; border: 2px solid white; }
    #info { position: absolute; top: 10px; left: 50%; transform: translateX(-50%); 
            color: white; font-family: Arial, sans-serif; }
  </style>
</head>
<body>
  <div id="info">Điểm: <span id="score">0 - 0</span> | Chế độ: <span id="mode">1 người</span> | Nhấn P để đổi</div>
  <canvas id="gameCanvas" width="800" height="500"></canvas>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const scoreDisplay = document.getElementById("score");
    const modeDisplay = document.getElementById("mode");

    let paddleHeight = 100, paddleWidth = 10;
    let leftPaddleY = canvas.height / 2 - paddleHeight / 2;
    let rightPaddleY = canvas.height / 2 - paddleHeight / 2;
    let paddleSpeed = 6;

    let ballSize = 10;
    let ballX = canvas.width / 2, ballY = canvas.height / 2;
    let ballSpeedX = 4, ballSpeedY = 4;

    let leftScore = 0, rightScore = 0;
    let twoPlayer = false; // mặc định 1 người

    let wPressed = false, sPressed = false;
    let upPressed = false, downPressed = false;

    document.addEventListener("keydown", (e) => {
      if (e.key === "w" || e.key === "W") wPressed = true;
      if (e.key === "s" || e.key === "S") sPressed = true;
      if (e.key === "ArrowUp") upPressed = true;
      if (e.key === "ArrowDown") downPressed = true;
      if (e.key === "p" || e.key === "P") {
        twoPlayer = !twoPlayer;
        modeDisplay.textContent = twoPlayer ? "2 người" : "1 người";
        resetBall();
      }
    });
    document.addEventListener("keyup", (e) => {
      if (e.key === "w" || e.key === "W") wPressed = false;
      if (e.key === "s" || e.key === "S") sPressed = false;
      if (e.key === "ArrowUp") upPressed = false;
      if (e.key === "ArrowDown") downPressed = false;
    });

    // Chuột điều khiển paddle phải (chỉ khi 1 người)
    canvas.addEventListener("mousemove", (e) => {
      if (!twoPlayer) {
        let rect = canvas.getBoundingClientRect();
        rightPaddleY = e.clientY - rect.top - paddleHeight / 2;
      }
    });

    function resetBall() {
      ballX = canvas.width / 2;
      ballY = canvas.height / 2;
      ballSpeedX = (Math.random() > 0.5 ? 4 : -4);
      ballSpeedY = (Math.random() > 0.5 ? 4 : -4);
    }

    function update() {
      // Player 1
      if (twoPlayer) {
        if (wPressed && leftPaddleY > 0) leftPaddleY -= paddleSpeed;
        if (sPressed && leftPaddleY < canvas.height - paddleHeight) leftPaddleY += paddleSpeed;
      } else {
        if (upPressed && leftPaddleY > 0) leftPaddleY -= paddleSpeed;
        if (downPressed && leftPaddleY < canvas.height - paddleHeight) leftPaddleY += paddleSpeed;
      }

      // Player 2 (chỉ trong chế độ 2 người)
      if (twoPlayer) {
        if (upPressed && rightPaddleY > 0) rightPaddleY -= paddleSpeed;
        if (downPressed && rightPaddleY < canvas.height - paddleHeight) rightPaddleY += paddleSpeed;
      } else {
        // AI nếu không dùng chuột
        if (ballX > canvas.width / 2) {
          if (ballY < rightPaddleY + paddleHeight / 2) rightPaddleY -= paddleSpeed * 0.5;
          else if (ballY > rightPaddleY + paddleHeight / 2) rightPaddleY += paddleSpeed * 0.5;
        }
      }

      // Ball
      ballX += ballSpeedX;
      ballY += ballSpeedY;

      if (ballY <= 0 || ballY >= canvas.height - ballSize) ballSpeedY *= -1;

      // Paddle trái
      if (ballX <= paddleWidth &&
          ballY > leftPaddleY && ballY < leftPaddleY + paddleHeight) {
        ballSpeedX *= -1.1;
        let hitPos = ballY - (leftPaddleY + paddleHeight / 2);
        ballSpeedY = hitPos * 0.3;
      }

      // Paddle phải
      if (ballX >= canvas.width - paddleWidth - ballSize &&
          ballY > rightPaddleY && ballY < rightPaddleY + paddleHeight) {
        ballSpeedX *= -1.1;
        let hitPos = ballY - (rightPaddleY + paddleHeight / 2);
        ballSpeedY = hitPos * 0.3;
      }

      // Ghi điểm
      if (ballX < 0) { rightScore++; resetBall(); }
      if (ballX > canvas.width) { leftScore++; resetBall(); }

      scoreDisplay.textContent = `${leftScore} - ${rightScore}`;
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "white";
      ctx.fillRect(0, leftPaddleY, paddleWidth, paddleHeight);
      ctx.fillRect(canvas.width - paddleWidth, rightPaddleY, paddleWidth, paddleHeight);
      ctx.fillRect(ballX, ballY, ballSize, ballSize);
    }

    function gameLoop() {
      update();
      draw();
      requestAnimationFrame(gameLoop);
    }
    gameLoop();
  </script>
</body>
</html>
